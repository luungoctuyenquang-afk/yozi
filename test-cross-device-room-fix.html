<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è·¨è®¾å¤‡æˆ¿é—´è®¿é—®ä¿®å¤æµ‹è¯•</title>
    <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .test-wrapper {
            display: flex;
            gap: 20px;
            align-items: flex-start;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .test-container {
            width: 375px;
            height: 667px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            position: relative;
        }
        
        #mqtt-test-container-1, #mqtt-test-container-2 {
            width: 100%;
            height: 100%;
        }
        
        .test-info {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 5px 10px;
            border-radius: 12px;
            font-size: 11px;
            z-index: 9999;
            pointer-events: none;
            backdrop-filter: blur(10px);
        }
        
        .test-instructions {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            max-width: 350px;
            margin: 10px;
        }
        
        .test-instructions h3 {
            margin-top: 0;
            color: #764ba2;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 10px;
            text-align: center;
        }
        
        .test-step {
            margin: 15px 0;
            padding: 10px;
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .test-step strong {
            color: #667eea;
        }
        
        .expected-result {
            background: #e8f5e8;
            border-left-color: #28a745;
            color: #155724;
        }
        
        .test-scenarios {
            margin-top: 20px;
        }
        
        .scenario {
            margin: 10px 0;
            padding: 8px 12px;
            background: #fff3cd;
            border-left: 3px solid #ffc107;
            border-radius: 4px;
            font-size: 13px;
        }
    </style>
</head>
<body>
    <div class="test-wrapper">
        <!-- ç¬¬ä¸€ä¸ªè™šæ‹Ÿè®¾å¤‡ -->
        <div class="test-container">
            <div class="test-info">è®¾å¤‡A - æˆ¿é—´åˆ›å»ºè€…</div>
            <div id="mqtt-test-container-1"></div>
        </div>
        
        <!-- ç¬¬äºŒä¸ªè™šæ‹Ÿè®¾å¤‡ -->
        <div class="test-container">
            <div class="test-info">è®¾å¤‡B - æˆ¿é—´åŠ å…¥è€…</div>
            <div id="mqtt-test-container-2"></div>
        </div>
        
        <!-- æµ‹è¯•è¯´æ˜ -->
        <div class="test-instructions">
            <h3>ğŸ”§ è·¨è®¾å¤‡æˆ¿é—´è®¿é—®ä¿®å¤æµ‹è¯•</h3>
            
            <div class="test-step">
                <strong>ä¿®å¤å†…å®¹:</strong><br>
                ç§»é™¤äº†ä¸¥æ ¼çš„æœ¬åœ°æˆ¿é—´å­˜åœ¨æ€§æ£€æŸ¥ï¼Œç°åœ¨å…è®¸åŠ å…¥ä»»ä½•æ ¼å¼æ­£ç¡®çš„æˆ¿é—´ID
            </div>
            
            <div class="test-scenarios">
                <h4>ğŸ“ æµ‹è¯•åœºæ™¯</h4>
                
                <div class="scenario">
                    <strong>åœºæ™¯1:</strong> è®¾å¤‡Aåˆ›å»ºæˆ¿é—´ "test-room-001"
                </div>
                
                <div class="scenario">
                    <strong>åœºæ™¯2:</strong> è®¾å¤‡Bç›´æ¥è¾“å…¥ç›¸åŒæˆ¿é—´å·åŠ å…¥
                </div>
                
                <div class="scenario">
                    <strong>åœºæ™¯3:</strong> éªŒè¯ä¸¤è®¾å¤‡å¯ä»¥æ­£å¸¸èŠå¤©
                </div>
            </div>
            
            <div class="test-step expected-result">
                <strong>æœŸæœ›ç»“æœ:</strong><br>
                â€¢ è®¾å¤‡Bèƒ½æˆåŠŸåŠ å…¥è®¾å¤‡Aåˆ›å»ºçš„æˆ¿é—´<br>
                â€¢ ä¸å†å‡ºç°"æˆ¿é—´ä¸å­˜åœ¨"é”™è¯¯<br>
                â€¢ ä¸¤è®¾å¤‡å¯ä»¥æ­£å¸¸æ”¶å‘æ¶ˆæ¯<br>
                â€¢ å¤–éƒ¨æˆ¿é—´ä¼šè‡ªåŠ¨ä¿å­˜åŸºç¡€é…ç½®
            </div>
            
            <div class="test-step">
                <strong>æµ‹è¯•æ­¥éª¤:</strong><br>
                1. åœ¨è®¾å¤‡Aåˆ›å»ºæˆ¿é—´"test-fix-001"<br>
                2. åœ¨è®¾å¤‡BåŠ å…¥ç›¸åŒæˆ¿é—´å·<br>
                3. ä¸¤è¾¹å‘é€æµ‹è¯•æ¶ˆæ¯<br>
                4. æ£€æŸ¥localStorageä¸­çš„æˆ¿é—´é…ç½®
            </div>
        </div>
    </div>

    <script>
        // åŠ è½½MQTTèŠå¤©å®¤æ¨¡å—
        function loadMqttRoomScript() {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = 'js/screens/mqtt-room.js';
                script.onload = resolve;
                script.onerror = reject;
                document.head.appendChild(script);
            });
        }

        // åˆå§‹åŒ–ä¸¤ä¸ªè™šæ‹Ÿè®¾å¤‡
        async function initializeDevices() {
            try {
                await loadMqttRoomScript();
                
                // è®¾å¤‡A - æˆ¿é—´åˆ›å»ºè€…
                const deviceA = createMqttRoomApp({
                    mountEl: document.getElementById('mqtt-test-container-1'),
                    getPlayerName: () => 'è®¾å¤‡Aç”¨æˆ·',
                    brokerUrl: 'wss://test.mosquitto.org:8081/mqtt'
                });
                
                // è®¾å¤‡B - æˆ¿é—´åŠ å…¥è€…  
                const deviceB = createMqttRoomApp({
                    mountEl: document.getElementById('mqtt-test-container-2'),
                    getPlayerName: () => 'è®¾å¤‡Bç”¨æˆ·',
                    brokerUrl: 'wss://test.mosquitto.org:8081/mqtt'
                });

                console.log('âœ… ä¸¤ä¸ªè™šæ‹Ÿè®¾å¤‡å·²åˆå§‹åŒ–');
                console.log('ğŸ“ è¯·æŒ‰ç…§æµ‹è¯•è¯´æ˜è¿›è¡Œè·¨è®¾å¤‡æˆ¿é—´è®¿é—®æµ‹è¯•');
                
                // æ·»åŠ æµ‹è¯•æç¤º
                setTimeout(() => {
                    alert('æµ‹è¯•å‡†å¤‡å®Œæˆï¼\n\nè¯·æŒ‰ç…§å³ä¾§è¯´æ˜è¿›è¡Œæµ‹è¯•ï¼š\n1. åœ¨è®¾å¤‡Aåˆ›å»ºæˆ¿é—´\n2. åœ¨è®¾å¤‡BåŠ å…¥ç›¸åŒæˆ¿é—´\n3. éªŒè¯è·¨è®¾å¤‡èŠå¤©åŠŸèƒ½');
                }, 1000);
                
            } catch (error) {
                console.error('åˆå§‹åŒ–å¤±è´¥:', error);
                alert('åˆå§‹åŒ–å¤±è´¥: ' + error.message);
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('load', initializeDevices);
        
        // æµ‹è¯•å·¥å…·å‡½æ•°
        window.testFunctions = {
            // æ£€æŸ¥localStorageä¸­çš„æˆ¿é—´é…ç½®
            checkRoomConfigs: () => {
                const configs = JSON.parse(localStorage.getItem('mqtt_room_configs') || '{}');
                console.log('å½“å‰æˆ¿é—´é…ç½®:', configs);
                return configs;
            },
            
            // æ¸…é™¤æµ‹è¯•æ•°æ®
            clearTestData: () => {
                localStorage.removeItem('mqtt_room_configs');
                localStorage.removeItem('mqtt_room_history');
                console.log('æµ‹è¯•æ•°æ®å·²æ¸…é™¤');
            },
            
            // æ¨¡æ‹Ÿå¤–éƒ¨æˆ¿é—´
            simulateExternalRoom: (roomId) => {
                console.log(`æ¨¡æ‹Ÿå¤–éƒ¨æˆ¿é—´: ${roomId}`);
                alert(`è¯·åœ¨è®¾å¤‡Bä¸­è¾“å…¥æˆ¿é—´å·: ${roomId}`);
            }
        };
    </script>
</body>
</html>