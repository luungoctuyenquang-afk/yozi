<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MQTTèŠå¤©å®¤ Phase 2 - æˆ¿é—´ç®¡ç†æµ‹è¯•</title>
    <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .test-wrapper {
            display: flex;
            gap: 20px;
            align-items: flex-start;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .test-container {
            width: 375px;
            height: 667px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            position: relative;
        }
        
        #mqtt-test-container-admin, #mqtt-test-container-user {
            width: 100%;
            height: 100%;
        }
        
        .test-info {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 5px 10px;
            border-radius: 12px;
            font-size: 11px;
            z-index: 9999;
            pointer-events: none;
            backdrop-filter: blur(10px);
        }
        
        .admin-info {
            background: rgba(255, 140, 0, 0.9);
        }
        
        .feature-panel {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            max-width: 350px;
            margin: 10px;
        }
        
        .feature-panel h3 {
            margin-top: 0;
            color: #764ba2;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 10px;
            text-align: center;
        }
        
        .feature-section {
            margin-bottom: 20px;
        }
        
        .feature-section h4 {
            color: #667eea;
            margin: 15px 0 8px 0;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .feature-item {
            padding: 6px 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            color: #555;
            font-size: 12px;
            border-left: 3px solid transparent;
            padding-left: 10px;
            margin: 4px 0;
        }
        
        .feature-item.implemented {
            border-left-color: #4cd964;
            background: rgba(76, 217, 100, 0.1);
        }
        
        .feature-item.testing {
            border-left-color: #ff9500;
            background: rgba(255, 149, 0, 0.1);
        }
        
        .icon {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
            color: white;
        }
        
        .implemented .icon {
            background: #4cd964;
        }
        
        .testing .icon {
            background: #ff9500;
        }
        
        .test-scenarios {
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            font-size: 12px;
            line-height: 1.5;
        }
        
        .test-scenarios h4 {
            margin-top: 0;
            color: #667eea;
            font-size: 13px;
        }
        
        .scenario {
            background: #f9f9f9;
            padding: 8px 10px;
            border-radius: 6px;
            margin: 6px 0;
            border-left: 3px solid #764ba2;
        }
        
        .scenario-title {
            font-weight: bold;
            color: #764ba2;
            margin-bottom: 4px;
        }
        
        .scenario-steps {
            font-size: 11px;
            color: #666;
        }
        
        .config-example {
            background: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 10px;
            font-family: monospace;
            font-size: 11px;
            margin: 8px 0;
            color: #333;
        }
        
        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-left: 5px;
        }
        
        .status-indicator.active {
            background: #4cd964;
            animation: pulse 2s infinite;
        }
        
        .status-indicator.inactive {
            background: #ccc;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .quick-setup {
            background: linear-gradient(135deg, #ff9500, #ffb84d);
            color: white;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            margin: 10px 0;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .quick-setup:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 149, 0, 0.3);
        }
        
        .quick-setup h5 {
            margin: 0 0 5px 0;
            font-size: 12px;
        }
        
        .quick-setup p {
            margin: 0;
            font-size: 10px;
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <div class="test-wrapper">
        <!-- ç®¡ç†å‘˜æµ‹è¯•å®¹å™¨ -->
        <div class="test-container">
            <div class="test-info admin-info">æˆ¿é—´ç®¡ç†å‘˜ ğŸ‘‘</div>
            <div id="mqtt-test-container-admin"></div>
        </div>
        
        <!-- åŠŸèƒ½è¯´æ˜é¢æ¿ -->
        <div class="feature-panel">
            <h3>ğŸ  Phase 2: æˆ¿é—´ç®¡ç†ç³»ç»Ÿ</h3>
            
            <div class="feature-section">
                <h4>ğŸ” å¯†ç ä¿æŠ¤åŠŸèƒ½ <span class="status-indicator active"></span></h4>
                <div class="feature-item implemented">
                    <span>æˆ¿é—´å¯†ç è®¾ç½®</span>
                    <span class="icon">âœ“</span>
                </div>
                <div class="feature-item implemented">
                    <span>è¿æ¥æ—¶å¯†ç éªŒè¯</span>
                    <span class="icon">âœ“</span>
                </div>
                <div class="feature-item implemented">
                    <span>å¯†ç é”™è¯¯æç¤º</span>
                    <span class="icon">âœ“</span>
                </div>
            </div>
            
            <div class="feature-section">
                <h4>ğŸ‘¥ äººæ•°é™åˆ¶åŠŸèƒ½ <span class="status-indicator active"></span></h4>
                <div class="feature-item implemented">
                    <span>æœ€å¤§äººæ•°è®¾ç½®</span>
                    <span class="icon">âœ“</span>
                </div>
                <div class="feature-item implemented">
                    <span>æˆ¿é—´æ»¡å‘˜æ£€æµ‹</span>
                    <span class="icon">âœ“</span>
                </div>
                <div class="feature-item implemented">
                    <span>å®æ—¶ç”¨æˆ·è®¡æ•°</span>
                    <span class="icon">âœ“</span>
                </div>
            </div>
            
            <div class="feature-section">
                <h4>âš™ï¸ æˆ¿é—´é…ç½®ç³»ç»Ÿ <span class="status-indicator active"></span></h4>
                <div class="feature-item implemented">
                    <span>æˆ¿é—´è®¾ç½®é¢æ¿</span>
                    <span class="icon">âœ“</span>
                </div>
                <div class="feature-item implemented">
                    <span>æˆ¿é—´åˆ†ç±»é€‰æ‹©</span>
                    <span class="icon">âœ“</span>
                </div>
                <div class="feature-item testing">
                    <span>é…ç½®æŒä¹…åŒ–å­˜å‚¨</span>
                    <span class="icon">ğŸ§ª</span>
                </div>
            </div>
            
            <div class="test-scenarios">
                <h4>ğŸ§ª æµ‹è¯•åœºæ™¯</h4>
                
                <div class="scenario">
                    <div class="scenario-title">åœºæ™¯1: å¯†ç ä¿æŠ¤æˆ¿é—´</div>
                    <div class="scenario-steps">
                        1. ç®¡ç†å‘˜è®¾ç½®æˆ¿é—´å¯†ç  "test123"<br>
                        2. æ™®é€šç”¨æˆ·å°è¯•æ— å¯†ç è¿æ¥ âŒ<br>
                        3. è¾“å…¥é”™è¯¯å¯†ç è¿æ¥ âŒ<br>
                        4. è¾“å…¥æ­£ç¡®å¯†ç è¿æ¥ âœ…
                    </div>
                </div>
                
                <div class="scenario">
                    <div class="scenario-title">åœºæ™¯2: æˆ¿é—´äººæ•°é™åˆ¶</div>
                    <div class="scenario-steps">
                        1. è®¾ç½®æœ€å¤§äººæ•°ä¸º 3 äºº<br>
                        2. 3ä¸ªç”¨æˆ·æˆåŠŸåŠ å…¥<br>
                        3. ç¬¬4ä¸ªç”¨æˆ·è¢«æ‹’ç» âŒ<br>
                        4. æœ‰ç”¨æˆ·ç¦»å¼€åå¯å†æ¬¡åŠ å…¥ âœ…
                    </div>
                </div>
                
                <div class="scenario">
                    <div class="scenario-title">åœºæ™¯3: æˆ¿é—´é…ç½®æŒä¹…åŒ–</div>
                    <div class="scenario-steps">
                        1. è®¾ç½®æˆ¿é—´é…ç½®å¹¶ä¿å­˜<br>
                        2. åˆ·æ–°é¡µé¢é‡æ–°è¿æ¥<br>
                        3. é…ç½®åº”è¯¥è¢«ä¿æŒ âœ…<br>
                        4. å…¶ä»–ç”¨æˆ·çœ‹åˆ°ç›¸åŒé™åˆ¶ âœ…
                    </div>
                </div>
            </div>
            
            <div class="config-example">
                <strong>æˆ¿é—´é…ç½®ç¤ºä¾‹ï¼š</strong><br>
                æˆ¿é—´å¯†ç : test123<br>
                æœ€å¤§äººæ•°: 5äºº<br>
                æˆ¿é—´åˆ†ç±»: èŠå¤©å®¤<br>
                ç§å¯†æˆ¿é—´: æ˜¯
            </div>
            
            <div class="quick-setup" onclick="quickSetupRoom()">
                <h5>âš¡ å¿«é€Ÿè®¾ç½®æµ‹è¯•æˆ¿é—´</h5>
                <p>è‡ªåŠ¨é…ç½®å¯†ç ä¿æŠ¤å’Œäººæ•°é™åˆ¶</p>
            </div>
        </div>
        
        <!-- æ™®é€šç”¨æˆ·æµ‹è¯•å®¹å™¨ -->
        <div class="test-container">
            <div class="test-info">æ™®é€šç”¨æˆ· ğŸ‘¤</div>
            <div id="mqtt-test-container-user"></div>
        </div>
    </div>
    
    <script src="js/screens/mqtt-room.js"></script>
    <script>
        // åˆ›å»ºç®¡ç†å‘˜å’Œæ™®é€šç”¨æˆ·å®ä¾‹
        const adminApp = createMqttRoomApp({
            mountEl: document.getElementById('mqtt-test-container-admin'),
            getPlayerName: () => 'ç®¡ç†å‘˜',
            brokerUrl: 'wss://test.mosquitto.org:8081/mqtt'
        });
        
        const userApp = createMqttRoomApp({
            mountEl: document.getElementById('mqtt-test-container-user'),
            getPlayerName: () => 'æ™®é€šç”¨æˆ·',
            brokerUrl: 'wss://test.mosquitto.org:8081/mqtt'
        });
        
        // å¿«é€Ÿè®¾ç½®æµ‹è¯•æˆ¿é—´
        function quickSetupRoom() {
            const adminContainer = document.getElementById('mqtt-test-container-admin');
            const roomInput = adminContainer.querySelector('.room-input');
            const nicknameInput = adminContainer.querySelector('.nickname-input');
            const settingsBtn = adminContainer.querySelector('.settings-toggle-btn');
            
            if (roomInput && nicknameInput) {
                // è®¾ç½®æˆ¿é—´ä¿¡æ¯
                roomInput.value = 'test-room-' + Math.floor(Date.now() / 1000);
                nicknameInput.value = 'æˆ¿é—´ç®¡ç†å‘˜';
                
                // å»¶è¿Ÿç‚¹å‡»è®¾ç½®æŒ‰é’®
                setTimeout(() => {
                    if (settingsBtn) {
                        settingsBtn.click();
                        
                        // å†å»¶è¿Ÿé…ç½®æˆ¿é—´è®¾ç½®
                        setTimeout(() => {
                            const passwordCheckbox = adminContainer.querySelector('#passwordProtected');
                            const passwordInput = adminContainer.querySelector('.room-password-input');
                            const maxUsersSelect = adminContainer.querySelector('.max-users-select');
                            
                            if (passwordCheckbox && passwordInput && maxUsersSelect) {
                                passwordCheckbox.checked = true;
                                passwordCheckbox.dispatchEvent(new Event('change'));
                                
                                setTimeout(() => {
                                    passwordInput.value = 'test123';
                                    maxUsersSelect.value = '5';
                                    
                                    console.log('âœ… æµ‹è¯•æˆ¿é—´å·²å¿«é€Ÿé…ç½®ï¼š');
                                    console.log('   æˆ¿é—´å·:', roomInput.value);
                                    console.log('   å¯†ç : test123');
                                    console.log('   æœ€å¤§äººæ•°: 5äºº');
                                    
                                    // ä¸ºæ™®é€šç”¨æˆ·è®¾ç½®ç›¸åŒæˆ¿é—´å·
                                    const userContainer = document.getElementById('mqtt-test-container-user');
                                    const userRoomInput = userContainer.querySelector('.room-input');
                                    if (userRoomInput) {
                                        userRoomInput.value = roomInput.value;
                                    }
                                }, 200);
                            }
                        }, 500);
                    }
                }, 200);
            }
        }
        
        console.log('%cğŸ  Phase 2: æˆ¿é—´ç®¡ç†ç³»ç»Ÿæµ‹è¯•ç¯å¢ƒ', 'color: #764ba2; font-size: 16px; font-weight: bold;');
        console.log('æ–°åŠŸèƒ½æµ‹è¯•ï¼š');
        console.log('ğŸ” å¯†ç ä¿æŠ¤ - è®¾ç½®æˆ¿é—´å¯†ç ä¿æŠ¤');
        console.log('ğŸ‘¥ äººæ•°é™åˆ¶ - é™åˆ¶æˆ¿é—´æœ€å¤§äººæ•°');
        console.log('âš™ï¸  æˆ¿é—´é…ç½® - æˆ¿é—´è®¾ç½®æŒä¹…åŒ–');
        console.log('ğŸ“Š ç”¨æˆ·è®¡æ•° - å®æ—¶ç”¨æˆ·æ•°è·Ÿè¸ª');
        console.log('');
        console.log('ğŸ§ª æµ‹è¯•æ­¥éª¤ï¼š');
        console.log('1. ç‚¹å‡»"å¿«é€Ÿè®¾ç½®æµ‹è¯•æˆ¿é—´"æŒ‰é’®');
        console.log('2. ç®¡ç†å‘˜è¿æ¥æˆ¿é—´ï¼ˆä¼šè‡ªåŠ¨è®¾ç½®å¯†ç ï¼‰');
        console.log('3. æ™®é€šç”¨æˆ·å°è¯•è¿æ¥ï¼ˆå…ˆä¸è¾“å…¥å¯†ç æµ‹è¯•ï¼‰');
        console.log('4. æ™®é€šç”¨æˆ·è¾“å…¥å¯†ç  test123 åè¿æ¥');
        console.log('5. è§‚å¯Ÿäººæ•°é™åˆ¶å’Œå¯†ç ä¿æŠ¤æ•ˆæœ');
    </script>
</body>
</html>