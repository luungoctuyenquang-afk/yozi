<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MQTTèŠå¤©å®¤ç•Œé¢ä¼˜åŒ–æµ‹è¯•</title>
    <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: #1a1a1a;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .test-container {
            width: 375px;
            height: 667px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            position: relative;
        }
        #mqtt-test-container {
            width: 100%;
            height: 100%;
        }
        .test-info {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 5px 10px;
            border-radius: 12px;
            font-size: 12px;
            z-index: 9999;
            pointer-events: none;
            backdrop-filter: blur(10px);
        }
        .controls {
            position: absolute;
            bottom: 20px;
            left: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 9999;
        }
        .control-btn {
            flex: 1;
            padding: 8px 12px;
            background: rgba(0,0,0,0.8);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 12px;
            cursor: pointer;
            backdrop-filter: blur(10px);
        }
        .control-btn:hover {
            background: rgba(0,0,0,0.9);
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-info">UIä¼˜åŒ–æµ‹è¯• v1.0</div>
        <div id="mqtt-test-container"></div>
    </div>
    
    <div class="controls">
        <button class="control-btn" onclick="simulateHistory()">æ¨¡æ‹Ÿå†å²è®°å½•</button>
        <button class="control-btn" onclick="toggleTheme()">åˆ‡æ¢ä¸»é¢˜</button>
        <button class="control-btn" onclick="simulateMessages()">æ¨¡æ‹Ÿæ¶ˆæ¯</button>
    </div>
    
    <script src="js/screens/mqtt-room.js"></script>
    <script>
        // æ¨¡æ‹Ÿè·å–ç©å®¶åç§°çš„å‡½æ•°
        function getPlayerName() {
            return 'UIæµ‹è¯•ç”¨æˆ·' + Math.floor(Math.random() * 100);
        }
        
        // åˆ›å»ºMQTTèŠå¤©å®¤åº”ç”¨
        const testContainer = document.getElementById('mqtt-test-container');
        const mqttApp = createMqttRoomApp({
            mountEl: testContainer,
            getPlayerName: getPlayerName,
            brokerUrl: 'wss://test.mosquitto.org:8081/mqtt'
        });
        
        // æµ‹è¯•å‡½æ•°
        function simulateHistory() {
            // æ¨¡æ‹Ÿæ·»åŠ å†å²è®°å½•
            const mockHistory = [
                { roomId: 'game-room-001', nickname: 'ç©å®¶A', lastUsed: Date.now() - 60000 },
                { roomId: 'chat-lobby', nickname: 'èŠå¤©ç”¨æˆ·', lastUsed: Date.now() - 120000 },
                { roomId: 'test-channel', nickname: 'æµ‹è¯•è´¦å·', lastUsed: Date.now() - 300000 },
                { roomId: 'dev-meeting', nickname: 'å¼€å‘è€…', lastUsed: Date.now() - 600000 }
            ];
            
            localStorage.setItem('mqtt_room_history', JSON.stringify(mockHistory));
            location.reload(); // é‡è½½é¡µé¢ä»¥æ˜¾ç¤ºå†å²è®°å½•
        }
        
        function toggleTheme() {
            const themeBtn = testContainer.querySelector('#theme-toggle-btn');
            if (themeBtn) {
                themeBtn.click();
            }
        }
        
        function simulateMessages() {
            const messagesContainer = testContainer.querySelector('#messages-container');
            if (messagesContainer) {
                // æ¸…ç©ºç°æœ‰å†…å®¹
                messagesContainer.innerHTML = '';
                
                // æ·»åŠ ä¸€äº›æµ‹è¯•æ¶ˆæ¯
                const messages = [
                    { user: 'ç”¨æˆ·A', text: 'å¤§å®¶å¥½ï¼è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•æ¶ˆæ¯', time: '2åˆ†é’Ÿå‰' },
                    { user: 'ç”¨æˆ·B', text: 'ç•Œé¢çœ‹èµ·æ¥ä¸é”™', time: '1åˆ†é’Ÿå‰' },
                    { user: 'æµ‹è¯•ç”¨æˆ·', text: 'æ»šåŠ¨æ¡ä¼˜åŒ–æ•ˆæœå¦‚ä½•ï¼Ÿ', time: '30ç§’å‰', isOwn: true },
                    { user: 'ç”¨æˆ·C', text: 'ä¸»é¢˜åˆ‡æ¢åŠŸèƒ½å¾ˆæ£’ï¼', time: '10ç§’å‰' }
                ];
                
                messages.forEach((msg, index) => {
                    setTimeout(() => {
                        const messageEl = document.createElement('div');
                        messageEl.className = `message chat ${msg.isOwn ? 'own-message' : ''}`;
                        
                        if (msg.isOwn) {
                            messageEl.innerHTML = `
                                <div class="message-header">
                                    <span class="message-time">${msg.time}</span>
                                </div>
                                <div class="message-text">${msg.text}</div>
                            `;
                        } else {
                            messageEl.innerHTML = `
                                <div class="message-header">
                                    <span class="user-name">${msg.user}</span>
                                    <span class="message-time">${msg.time}</span>
                                </div>
                                <div class="message-text">${msg.text}</div>
                            `;
                        }
                        
                        messagesContainer.appendChild(messageEl);
                        messagesContainer.scrollTop = messagesContainer.scrollHeight;
                    }, index * 500);
                });
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåçš„æµ‹è¯•
        setTimeout(() => {
            console.log('=== UIä¼˜åŒ–åŠŸèƒ½æµ‹è¯• ===');
            console.log('1. æ»šåŠ¨æ¡ç¾åŒ–:', testContainer.querySelector('.messages') ? 'âœ… å·²åº”ç”¨' : 'âŒ æœªæ‰¾åˆ°');
            console.log('2. ä¸»é¢˜åˆ‡æ¢:', testContainer.querySelector('#theme-toggle-btn') ? 'âœ… å·²é›†æˆ' : 'âŒ æœªæ‰¾åˆ°');
            console.log('3. æˆ¿é—´å†å²è®°å½•:', testContainer.querySelector('#room-history-container') ? 'âœ… å·²ä¼˜åŒ–' : 'âŒ æœªæ‰¾åˆ°');
            console.log('4. å“åº”å¼å¸ƒå±€:', window.innerWidth <= 480 ? 'âœ… å°å±å¹•é€‚é…' : 'ğŸ“± å¤§å±å¹•æ¨¡å¼');
            console.log('=====================');
        }, 1000);
    </script>
</body>
</html>