<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MQTT聊天室 - 使用指南</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Microsoft YaHei", sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .header .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .content {
            padding: 40px 30px;
        }

        .section {
            margin-bottom: 40px;
        }

        .section h2 {
            color: #764ba2;
            font-size: 1.8em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #f0f0f0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section h3 {
            color: #667eea;
            font-size: 1.3em;
            margin-top: 20px;
            margin-bottom: 15px;
        }

        .card {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }

        .warning-card {
            background: #fff3cd;
            border-left-color: #ffc107;
        }

        .danger-card {
            background: #f8d7da;
            border-left-color: #dc3545;
        }

        .success-card {
            background: #d4edda;
            border-left-color: #28a745;
        }

        .info-card {
            background: #d1ecf1;
            border-left-color: #17a2b8;
        }

        .steps {
            counter-reset: step-counter;
            list-style: none;
            padding: 0;
        }

        .steps li {
            counter-increment: step-counter;
            margin-bottom: 20px;
            padding-left: 50px;
            position: relative;
        }

        .steps li::before {
            content: counter(step-counter);
            position: absolute;
            left: 0;
            top: 0;
            background: #667eea;
            color: white;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .feature-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            transition: transform 0.3s ease;
        }

        .feature-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .feature-icon {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .faq-item {
            margin-bottom: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
        }

        .faq-question {
            background: #f8f9fa;
            padding: 15px 20px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .faq-question:hover {
            background: #e9ecef;
        }

        .faq-answer {
            padding: 15px 20px;
            background: white;
            display: none;
        }

        .faq-item.active .faq-answer {
            display: block;
        }

        .faq-item.active .faq-question::after {
            content: '▲';
        }

        .faq-question::after {
            content: '▼';
            color: #667eea;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        th {
            background: #f8f9fa;
            font-weight: bold;
            color: #667eea;
        }

        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
            margin: 0 5px;
        }

        .badge-new {
            background: #28a745;
            color: white;
        }

        .badge-important {
            background: #dc3545;
            color: white;
        }

        .badge-beta {
            background: #ffc107;
            color: #333;
        }

        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            color: #d63384;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .button {
            padding: 12px 24px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            transition: background 0.3s ease;
        }

        .button:hover {
            background: #764ba2;
        }

        .button-secondary {
            background: #6c757d;
        }

        .button-secondary:hover {
            background: #5a6268;
        }

        @media (max-width: 600px) {
            .header h1 {
                font-size: 1.8em;
            }

            .content {
                padding: 20px 15px;
            }

            .feature-grid {
                grid-template-columns: 1fr;
            }
        }

        /* 动画效果 */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .section {
            animation: fadeIn 0.6s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🌐 MQTT聊天室使用指南</h1>
            <div class="subtitle">多人实时聊天 · 房间管理 · 安全加密</div>
        </div>

        <div class="content">
            <!-- 快速开始 -->
            <section class="section">
                <h2>🚀 快速开始</h2>

                <div class="card success-card">
                    <strong>提示：</strong>MQTT聊天室支持多人实时聊天、私聊、表情、房间管理等功能。
                    无需注册账号，输入房间号和昵称即可开始！
                </div>

                <h3>创建房间（房主）</h3>
                <ol class="steps">
                    <li>输入一个<strong>唯一的房间号</strong>（如：my-room-2024）</li>
                    <li>输入您的<strong>昵称</strong>（将成为房主身份）</li>
                    <li>选择房间类型（临时或正式）</li>
                    <li>点击<strong>"创建房间"</strong>按钮</li>
                    <li>（重要）点击<strong>"备份房间"</strong>保存房间数据</li>
                </ol>

                <h3>加入房间（访客）</h3>
                <ol class="steps">
                    <li>输入<strong>房间号</strong>（向房主获取）</li>
                    <li>输入您的<strong>昵称</strong></li>
                    <li>点击<strong>"加入房间"</strong>按钮</li>
                    <li>如有密码，输入房间密码</li>
                </ol>
            </section>

            <!-- 核心功能 -->
            <section class="section">
                <h2>✨ 核心功能</h2>

                <div class="feature-grid">
                    <div class="feature-item">
                        <div class="feature-icon">👥</div>
                        <h4>多人聊天</h4>
                        <p>支持多人同时在线，实时消息同步</p>
                    </div>

                    <div class="feature-item">
                        <div class="feature-icon">🔒</div>
                        <h4>密码保护</h4>
                        <p>可设置房间密码，保护私密聊天</p>
                    </div>

                    <div class="feature-item">
                        <div class="feature-icon">👑</div>
                        <h4>房主权限</h4>
                        <p>房主可管理房间、设置管理员、踢出用户</p>
                    </div>

                    <div class="feature-item">
                        <div class="feature-icon">💬</div>
                        <h4>私聊功能</h4>
                        <p>点击用户名可发起私密对话</p>
                    </div>

                    <div class="feature-item">
                        <div class="feature-icon">😊</div>
                        <h4>表情支持</h4>
                        <p>丰富的表情符号，让聊天更生动</p>
                    </div>

                    <div class="feature-item">
                        <div class="feature-icon">💾</div>
                        <h4>数据备份</h4>
                        <p>支持导出/导入房间数据和聊天记录</p>
                    </div>
                </div>
            </section>

            <!-- 房间管理 -->
            <section class="section">
                <h2>🏠 房间管理</h2>

                <h3>房间类型说明</h3>
                <table>
                    <tr>
                        <th>类型</th>
                        <th>特点</th>
                        <th>适用场景</th>
                        <th>数据保存</th>
                    </tr>
                    <tr>
                        <td><strong>临时房间</strong></td>
                        <td>快速创建，无需密钥</td>
                        <td>临时聚会、一次性活动</td>
                        <td>本地保存</td>
                    </tr>
                    <tr>
                        <td><strong>正式房间</strong> <span class="badge badge-new">新</span></td>
                        <td>需要密钥，更安全</td>
                        <td>长期群组、团队协作</td>
                        <td>加密保存</td>
                    </tr>
                </table>

                <h3>房间权限等级</h3>
                <div class="card">
                    <p><strong>👑 房主</strong>：创建房间的人，拥有最高权限</p>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li>设置/修改房间密码</li>
                        <li>任命/撤销管理员</li>
                        <li>踢出任何用户</li>
                        <li>备份/恢复房间数据</li>
                        <li>释放/关闭房间</li>
                    </ul>
                </div>

                <div class="card">
                    <p><strong>⭐ 管理员</strong>：房主指定的协助管理者</p>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li>踢出普通用户</li>
                        <li>管理聊天秩序</li>
                        <li>无法修改房间设置</li>
                    </ul>
                </div>

                <div class="card">
                    <p><strong>👤 访客</strong>：普通用户</p>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li>发送消息</li>
                        <li>使用表情</li>
                        <li>发起私聊</li>
                    </ul>
                </div>
            </section>

            <!-- 重要功能说明 -->
            <section class="section">
                <h2>⚡ 重要功能说明</h2>

                <h3>房间占用机制 <span class="badge badge-important">重要</span></h3>
                <div class="card warning-card">
                    <p><strong>什么是房间占用？</strong></p>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li>创建房间后，房间ID被锁定，其他人无法创建同名房间</li>
                        <li>只有房主激活房间（创建或导入备份）后，其他人才能加入</li>
                        <li>房主离开时可选择是否释放房间</li>
                    </ul>
                </div>

                <h3>数据备份与恢复</h3>
                <div class="card info-card">
                    <p><strong>为什么要备份？</strong></p>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li>保存房主身份和权限</li>
                        <li>保存聊天记录</li>
                        <li>保存房间设置和管理员列表</li>
                        <li>房间ID被占用时可用新ID恢复</li>
                    </ul>
                    <p style="margin-top: 15px;"><strong>如何备份？</strong></p>
                    <p>房主在房间内点击"备份房间"按钮，系统会生成JSON文件下载</p>
                </div>

                <h3>房间释放说明</h3>
                <div class="card">
                    <p><strong>释放房间</strong> = 放弃房间所有权</p>
                    <table style="margin-top: 10px;">
                        <tr>
                            <th>选择</th>
                            <th>效果</th>
                            <th>建议场景</th>
                        </tr>
                        <tr>
                            <td>释放</td>
                            <td>房间ID可被他人使用，房间关闭</td>
                            <td>临时活动结束</td>
                        </tr>
                        <tr>
                            <td>不释放</td>
                            <td>房间保持激活，他人可继续使用</td>
                            <td>长期群组</td>
                        </tr>
                    </table>
                </div>
            </section>

            <!-- 常见问题 -->
            <section class="section">
                <h2>❓ 常见问题</h2>

                <div class="faq-item">
                    <div class="faq-question">
                        为什么提示"房间不存在或未激活"？
                    </div>
                    <div class="faq-answer">
                        <p>可能的原因：</p>
                        <ul style="margin-left: 20px;">
                            <li>房间ID输入错误</li>
                            <li>房主还未创建此房间</li>
                            <li>房主已释放此房间</li>
                            <li>房主创建后未导入备份激活</li>
                        </ul>
                        <p style="margin-top: 10px;"><strong>解决方法：</strong>确认房间ID，联系房主确认房间状态</p>
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question">
                        房主忘记备份怎么办？
                    </div>
                    <div class="faq-answer">
                        <p>如果房主还在房间内，可以随时点击"备份房间"。</p>
                        <p>如果已经离开且选择了释放，房间数据将无法恢复，需要创建新房间。</p>
                        <p><strong>建议：</strong>创建房间后立即备份！</p>
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question">
                        旧版本创建的房间还能用吗？
                    </div>
                    <div class="faq-answer">
                        <p>旧版本房间需要升级才能使用新功能。房主尝试创建同ID房间时，系统会提示升级。</p>
                        <p>升级后房间将：</p>
                        <ul style="margin-left: 20px;">
                            <li>生成安全密钥</li>
                            <li>激活到服务器</li>
                            <li>支持所有新功能</li>
                        </ul>
                        <p><strong>注意：</strong>尽快升级，避免房间ID被他人占用！</p>
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question">
                        如何设置房间密码？
                    </div>
                    <div class="faq-answer">
                        <p>房主在创建房间时：</p>
                        <ol style="margin-left: 20px;">
                            <li>点击"高级设置"</li>
                            <li>勾选"私密房间"</li>
                            <li>输入房间密码</li>
                            <li>点击"保存密码"</li>
                        </ol>
                        <p style="margin-top: 10px;">访客加入时需要输入正确密码才能进入。</p>
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question">
                        聊天记录会保存多久？
                    </div>
                    <div class="faq-answer">
                        <p>聊天记录保存在本地浏览器中：</p>
                        <ul style="margin-left: 20px;">
                            <li>每个房间最多保存500条消息</li>
                            <li>清除浏览器数据会丢失记录</li>
                            <li>可通过"导出聊天记录"功能备份</li>
                            <li>房主备份包含完整聊天记录</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- 安全与隐私 -->
            <section class="section">
                <h2>🔐 安全与隐私</h2>

                <div class="card danger-card">
                    <h3>⚠️ 安全提醒</h3>
                    <ul style="margin-left: 20px;">
                        <li>不要在公共聊天室分享个人敏感信息</li>
                        <li>房间密码请通过安全渠道分享</li>
                        <li>重要房间请定期备份</li>
                        <li>发现恶意用户请及时踢出</li>
                    </ul>
                </div>

                <h3>数据存储说明</h3>
                <div class="card">
                    <table>
                        <tr>
                            <th>数据类型</th>
                            <th>存储位置</th>
                            <th>加密状态</th>
                        </tr>
                        <tr>
                            <td>房间配置</td>
                            <td>本地 + MQTT服务器</td>
                            <td>部分加密</td>
                        </tr>
                        <tr>
                            <td>聊天记录</td>
                            <td>本地浏览器</td>
                            <td>未加密</td>
                        </tr>
                        <tr>
                            <td>用户信息</td>
                            <td>仅会话期间</td>
                            <td>不存储</td>
                        </tr>
                    </table>
                </div>
            </section>

            <!-- 技术信息 -->
            <section class="section">
                <h2>🛠 技术信息</h2>

                <div class="card">
                    <h3>连接信息</h3>
                    <p><strong>MQTT Broker：</strong><code>wss://test.mosquitto.org:8081/mqtt</code></p>
                    <p><strong>协议：</strong>WebSocket over TLS</p>
                    <p><strong>QoS级别：</strong>0（最多一次）/ 1（至少一次）</p>
                </div>

                <div class="card">
                    <h3>浏览器要求</h3>
                    <ul style="margin-left: 20px;">
                        <li>Chrome 80+ / Firefox 75+ / Safari 13+</li>
                        <li>支持WebSocket</li>
                        <li>支持localStorage</li>
                        <li>建议开启JavaScript</li>
                    </ul>
                </div>

                <div class="card">
                    <h3>限制说明</h3>
                    <ul style="margin-left: 20px;">
                        <li>房间号：仅支持字母、数字、横线、下划线</li>
                        <li>昵称长度：最多20个字符</li>
                        <li>消息长度：建议不超过1000字符</li>
                        <li>在线人数：建议不超过50人</li>
                        <li>文件分享：暂不支持</li>
                    </ul>
                </div>
            </section>

            <!-- 更新日志 -->
            <section class="section">
                <h2>📝 更新日志</h2>

                <div class="card">
                    <h3>v2.0 - 房间占用机制 <span class="badge badge-new">最新</span></h3>
                    <ul style="margin-left: 20px;">
                        <li>✨ 新增房间ID占用保护</li>
                        <li>✨ 新增房间激活验证</li>
                        <li>✨ 支持旧版本房间升级</li>
                        <li>🔧 修复房间权限同步问题</li>
                        <li>🔧 优化房间备份恢复流程</li>
                    </ul>
                </div>

                <div class="card">
                    <h3>v1.5 - 权限管理</h3>
                    <ul style="margin-left: 20px;">
                        <li>新增管理员功能</li>
                        <li>新增踢人功能</li>
                        <li>新增私聊功能</li>
                        <li>优化在线用户显示</li>
                    </ul>
                </div>

                <div class="card">
                    <h3>v1.0 - 基础功能</h3>
                    <ul style="margin-left: 20px;">
                        <li>多人实时聊天</li>
                        <li>表情支持</li>
                        <li>房间密码</li>
                        <li>聊天记录</li>
                    </ul>
                </div>
            </section>

            <!-- 联系与反馈 -->
            <section class="section">
                <h2>📧 联系与反馈</h2>

                <div class="card info-card">
                    <p>如果您在使用过程中遇到问题或有改进建议，欢迎反馈！</p>
                    <div class="button-group" style="margin-top: 20px;">
                        <a href="#" class="button" onclick="alert('请联系管理员'); return false;">报告问题</a>
                        <a href="#" class="button button-secondary" onclick="alert('感谢您的建议！'); return false;">提交建议</a>
                    </div>
                </div>

                <div class="card">
                    <h3>快捷操作</h3>
                    <ul style="margin-left: 20px;">
                        <li><strong>@用户名</strong> - 提及某人</li>
                        <li><strong>/clear</strong> - 清空本地聊天记录</li>
                        <li><strong>双击消息</strong> - 快速回复</li>
                        <li><strong>Ctrl+Enter</strong> - 发送消息</li>
                    </ul>
                </div>
            </section>
        </div>
    </div>

    <script>
        // FAQ折叠展开功能
        document.querySelectorAll('.faq-question').forEach(question => {
            question.addEventListener('click', () => {
                const item = question.parentElement;
                item.classList.toggle('active');

                // 关闭其他展开的FAQ
                document.querySelectorAll('.faq-item').forEach(otherItem => {
                    if (otherItem !== item && otherItem.classList.contains('active')) {
                        otherItem.classList.remove('active');
                    }
                });
            });
        });

        // 平滑滚动
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // 添加页面加载动画
        window.addEventListener('load', () => {
            document.querySelectorAll('.section').forEach((section, index) => {
                section.style.animationDelay = `${index * 0.1}s`;
            });
        });
    </script>
</body>
</html>